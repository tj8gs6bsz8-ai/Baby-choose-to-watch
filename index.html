<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ°´æœè¾¨è­˜æŒ‘æˆ°</title>
    <style>
        /* --- åŸºç¤è¨­å®š --- */
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f2f5;
            font-family: "Microsoft JhengHei", sans-serif;
        }

        /* --- éŠæˆ²ä¸»å®¹å™¨ (4:5 æ¯”ä¾‹) --- */
        #game-container {
            width: 90vw;
            max-width: 400px;
            aspect-ratio: 4 / 5;
            background-color: #fff;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            padding: 20px;
            box-sizing: border-box;
            position: relative;
            overflow: hidden; /* ç‚ºäº†é®ç½©å±¤ */
        }

        /* --- æ¨™é¡Œå€ --- */
        header {
            text-align: center;
            margin-bottom: 15px;
        }
        h1 { margin: 0; font-size: 1.5rem; color: #333; }
        p { margin: 5px 0 0; color: #666; font-size: 1rem; }

        /* --- 3x3 éŠæˆ²å€ --- */
        #grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 10px;
            flex-grow: 1;
        }

        /* --- æ ¼å­æ¨£å¼ (é è¨­å³é¡¯ç¤º) --- */
        .cell {
            background-color: #f1f2f6;
            border: 2px solid #dfe4ea;
            border-radius: 15px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3rem; /* åœ–ç¤ºå¤§ä¸€é» */
            transition: all 0.2s;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .cell:active { transform: scale(0.95); }

        /* æ­£ç¢ºé¸å–å¾Œçš„æ¨£å¼ (è®Šæš—æˆ–æ‰“å‹¾) */
        .cell.collected {
            background-color: #55efc4;
            opacity: 0.5;
            pointer-events: none; /* ä¸èƒ½å†é» */
            border-color: #00b894;
        }

        /* é»åˆ°ç‚¸å½ˆçš„æ¨£å¼ */
        .cell.boom {
            background-color: #ff7675;
            animation: shake 0.5s;
        }

        /* --- é–‹å§‹/é®ç½©å±¤ (ç‚ºäº†è§¸ç™¼éŸ³æ•ˆï¼Œç€è¦½å™¨é€šå¸¸éœ€è¦ä½¿ç”¨è€…å…ˆäº’å‹•) --- */
        #overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(255,255,255,0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }
        
        #start-btn, #restart-btn {
            padding: 15px 40px;
            border: none;
            background-color: #0984e3;
            color: white;
            font-size: 1.5rem;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(9, 132, 227, 0.4);
            transition: transform 0.2s;
        }
        
        #start-btn:active, #restart-btn:active { transform: scale(0.95); }

        /* éš±è—å…ƒç´  */
        .hidden { display: none !important; }

        /* éŒ¯èª¤æ™‚çš„éœ‡å‹•å‹•ç•« */
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }
    </style>
</head>
<body>

<div id="game-container">
    <header>
        <h1>è¾¨è­˜å¤§æŒ‘æˆ°</h1>
        <p id="status-text">æº–å‚™å¥½äº†å—ï¼Ÿ</p>
    </header>

    <div id="grid">
        </div>

    <div id="overlay">
        <h2 id="overlay-msg" style="margin-bottom: 20px; color:#333;">é»æ“Šé–‹å§‹éŠæˆ²</h2>
        <button id="start-btn" onclick="startGame()">é–‹å§‹éŠæˆ²</button>
    </div>
</div>

<script>
    // --- éŠæˆ²åƒæ•¸ ---
    const totalCells = 9;
    const safeCount = 6;
    const boomCount = 3;
    
    const fruitIcons = ['ğŸ', 'ğŸŒ', 'ğŸ‡', 'ğŸŠ', 'ğŸ“', 'ğŸ‘', 'ğŸ', 'ğŸˆ'];
    const bombIcons = ['ğŸ’£', 'ğŸ§¨', 'ğŸ’¥']; // é€™è£¡è¨­å®šéæ°´æœåœ–ç¤º

    let gridData = []; 
    let collectedCount = 0;
    let isGameOver = false;

    // --- éŸ³æ•ˆèˆ‡èªéŸ³ ---
    // ç°¡å–®çš„ Web Audio API åˆæˆéŸ³æ•ˆ (ä¸ç”¨å¤–éƒ¨æª”æ¡ˆ)
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function playTone(freq, type) {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.5);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(0.5);
    }

    // èªéŸ³å°è®€ (TTS)
    function speak(text) {
        if ('speechSynthesis' in window) {
            // å–æ¶ˆä¹‹å‰çš„ç™¼éŸ³ï¼Œé¿å…é‡ç–Š
            window.speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'zh-TW'; // è¨­å®šç‚ºä¸­æ–‡
            utterance.rate = 1;       // èªé€Ÿ
            utterance.pitch = 1;      // éŸ³èª¿
            window.speechSynthesis.speak(utterance);
        }
    }

    // --- éŠæˆ²é‚è¼¯ ---

    function startGame() {
        // éš±è—é®ç½©
        document.getElementById('overlay').classList.add('hidden');
        resetBoard();
        
        // æ’­æ”¾éŸ³æ•ˆ + èªéŸ³
        playTone(600, 'sine'); // é–‹å§‹éŸ³æ•ˆ
        setTimeout(() => {
            speak("è«‹é»é¸æ°´æœ");
            document.getElementById('status-text').textContent = "è«‹é»é¸æ°´æœ ğŸ";
        }, 500);
    }

    function resetBoard() {
        const grid = document.getElementById('grid');
        grid.innerHTML = '';
        collectedCount = 0;
        isGameOver = false;

        // 1. æº–å‚™æ•¸æ“šï¼š6æ°´æœ + 3ç‚¸å½ˆ
        let items = [];
        
        // éš¨æ©Ÿé¸6å€‹æ°´æœ
        for(let i=0; i<safeCount; i++) {
            const icon = fruitIcons[Math.floor(Math.random() * fruitIcons.length)];
            items.push({ type: 'safe', icon: icon });
        }
        // éš¨æ©Ÿé¸3å€‹ç‚¸å½ˆ
        for(let i=0; i<boomCount; i++) {
            items.push({ type: 'boom', icon: 'ğŸ’£' });
        }

        // 2. æ‰“äº‚ (Shuffle)
        for (let i = items.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [items[i], items[j]] = [items[j], items[i]];
        }
        gridData = items;

        // 3. æ¸²æŸ“æ ¼å­ (ç›´æ¥é¡¯ç¤ºåœ–ç¤º)
        items.forEach((item, index) => {
            const cell = document.createElement('div');
            cell.classList.add('cell');
            cell.textContent = item.icon; // ç›´æ¥é¡¯ç¤º
            cell.onclick = () => handleCellClick(index, cell);
            grid.appendChild(cell);
        });
    }

    function handleCellClick(index, cell) {
        if (isGameOver || cell.classList.contains('collected')) return;

        const item = gridData[index];

        if (item.type === 'safe') {
            // --- é»å°äº† (æ°´æœ) ---
            cell.classList.add('collected');
            playTone(800, 'sine'); // æ¸…è„†éŸ³
            collectedCount++;

            // æª¢æŸ¥éé—œ
            if (collectedCount === safeCount) {
                gameWin();
            }
        } else {
            // --- é»éŒ¯äº† (ç‚¸å½ˆ) ---
            cell.classList.add('boom');
            playTone(150, 'sawtooth'); // ä½æ²‰éŒ¯èª¤éŸ³
            gameOver();
        }
    }

    function gameWin() {
        isGameOver = true;
        speak("æ­å–œéé—œ");
        document.getElementById('status-text').textContent = "ğŸ‰ å…¨æ•¸å®‰å…¨ï¼";
        document.getElementById('status-text').style.color = "#00b894";
        showOverlay("å¤ªæ£’äº†ï¼éé—œï¼", "å†ç©ä¸€æ¬¡");
    }

    function gameOver() {
        isGameOver = true;
        speak("çˆ†ç‚¸äº†ï¼ŒéŠæˆ²çµæŸ");
        document.getElementById('status-text').textContent = "ğŸ’¥ é»åˆ°ç‚¸å½ˆäº†ï¼";
        document.getElementById('status-text').style.color = "#d63031";
        showOverlay("ğŸ’¥ å¤±æ•—ï¼", "é‡æ–°æŒ‘æˆ°");
    }

    function showOverlay(msg, btnText) {
        setTimeout(() => {
            const overlay = document.getElementById('overlay');
            const title = document.getElementById('overlay-msg');
            const btn = document.getElementById('start-btn');
            
            title.textContent = msg;
            btn.textContent = btnText;
            overlay.classList.remove('hidden');
        }, 1000); // å»¶é²ä¸€ç§’é¡¯ç¤ºçµæœï¼Œè®“ç©å®¶çœ‹åˆ°æœ€å¾Œçš„æ“ä½œ
    }
</script>

</body>
</html>
