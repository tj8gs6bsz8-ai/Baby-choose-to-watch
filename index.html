<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>æ°´æœè¾¨è­˜å¤§æŒ‘æˆ°</title>
    <style>
        /* --- å…¨å±€è¨­å®š --- */
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #ffeaa7; /* æŸ”å’Œçš„é»ƒè‰²èƒŒæ™¯ */
            font-family: "Microsoft JhengHei", "PingFang TC", sans-serif;
            overflow: hidden; /* é˜²æ­¢æ²å‹• */
        }

        /* --- éŠæˆ²ä¸»é«”å®¹å™¨ (ç¶­æŒ 4:5 æ‰‹æ©Ÿæ¯”ä¾‹) --- */
        #game-container {
            width: 90vw;
            max-width: 420px;
            aspect-ratio: 4 / 5;
            background-color: #ffffff;
            border-radius: 24px;
            box-shadow: 0 12px 35px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            padding: 24px;
            box-sizing: border-box;
            position: relative;
            overflow: hidden;
        }

        /* --- æ¨™é¡Œå€åŸŸ --- */
        header {
            text-align: center;
            margin-bottom: 16px;
            flex-shrink: 0;
        }
        h1 { margin: 0; font-size: 1.8rem; color: #2d3436; letter-spacing: 1px; }
        p#status-text { 
            margin: 8px 0 0; 
            color: #636e72; 
            font-size: 1.2rem; 
            font-weight: bold;
            min-height: 1.5em; 
        }

        /* --- 3x3 ä¹å®®æ ¼ --- */
        #grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 12px;
            flex-grow: 1;
        }

        /* --- æ ¼å­æ¨£å¼ --- */
        .cell {
            background-color: #f5f6fa;
            border: 3px solid #dcdde1;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3.5rem; /* Emoji å¤§å° */
            transition: transform 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .cell:active { transform: scale(0.92); }

        /* æ­£ç¢º (æ°´æœ) æ¨£å¼ */
        .cell.correct {
            background-color: #55efc4;
            border-color: #00b894;
            color: rgba(255,255,255,0.8);
            pointer-events: none; /* é–å®šä¸å¯å†é» */
        }
        /* é¸ä¸­å¾Œåœ–ç¤ºåŠé€æ˜ï¼Œé¡¯ç¤ºã€Œå·²æ”¶é›†ã€çš„æ„Ÿè¦º */
        .cell.correct::after {
            content: 'âœ…';
            position: absolute;
            font-size: 1.5rem;
            opacity: 0.8;
        }

        /* éŒ¯èª¤ (é™·é˜±) æ¨£å¼ */
        .cell.wrong {
            background-color: #ff7675;
            border-color: #d63031;
            animation: shake 0.5s;
        }

        /* --- é®ç½©å±¤ (é–‹å§‹/çµç®—) --- */
        #overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(255, 255, 255, 0.96);
            backdrop-filter: blur(5px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            transition: opacity 0.3s;
        }

        #overlay-title {
            font-size: 2rem;
            color: #2d3436;
            margin-bottom: 30px;
            font-weight: 800;
        }

        #action-btn {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            border: none;
            padding: 16px 48px;
            color: white;
            font-size: 1.4rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(9, 132, 227, 0.4);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        #action-btn:active {
            transform: translateY(2px);
            box-shadow: 0 4px 10px rgba(9, 132, 227, 0.3);
        }

        /* å·¥å…·é¡ */
        .hidden { 
            opacity: 0; 
            pointer-events: none; 
            visibility: hidden;
        }

        /* éŒ¯èª¤éœ‡å‹•å‹•ç•« */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-10px) rotate(-5deg); }
            40% { transform: translateX(10px) rotate(5deg); }
            60% { transform: translateX(-10px) rotate(-5deg); }
            80% { transform: translateX(10px) rotate(5deg); }
        }
    </style>
</head>
<body>

<div id="game-container">
    <header>
        <h1>ğŸ æ°´æœé»é»å</h1>
        <p id="status-text">è«‹æ‰¾å‡ºæ‰€æœ‰æ°´æœï¼</p>
    </header>

    <div id="grid">
        </div>

    <div id="overlay">
        <div id="overlay-title">æº–å‚™å¥½äº†å—ï¼Ÿ</div>
        <button id="action-btn" onclick="startGame()">é–‹å§‹éŠæˆ²</button>
    </div>
</div>

<script>
    /* =========================================
       1. è³‡æ–™åº«è¨­å®š (æ“´å……ç‰ˆ)
       ========================================= */
    
    // æ°´æœåˆ—è¡¨ (ç›®æ¨™)
    const fruitPool = [
        { icon: 'ğŸ', name: 'ç´…è˜‹æœ' }, { icon: 'ğŸ', name: 'é’è˜‹æœ' },
        { icon: 'ğŸŒ', name: 'é¦™è•‰' },   { icon: 'ğŸ‡', name: 'è‘¡è„' },
        { icon: 'ğŸŠ', name: 'æ©˜å­' },   { icon: 'ğŸ“', name: 'è‰è“' },
        { icon: 'ğŸ‰', name: 'è¥¿ç“œ' },   { icon: 'ğŸ', name: 'é³³æ¢¨' },
        { icon: 'ğŸ¥', name: 'å¥‡ç•°æœ' }, { icon: 'ğŸ‘', name: 'æ°´èœœæ¡ƒ' },
        { icon: 'ğŸ’', name: 'æ«»æ¡ƒ' },   { icon: 'ğŸˆ', name: 'å“ˆå¯†ç“œ' },
        { icon: 'ğŸ‹', name: 'æª¸æª¬' },   { icon: 'ğŸ', name: 'è¥¿æ´‹æ¢¨' },
        { icon: 'ğŸ¥­', name: 'èŠ’æœ' },   { icon: 'ğŸ¥¥', name: 'æ¤°å­' },
        { icon: 'ğŸ¥‘', name: 'é…ªæ¢¨' },   { icon: 'ğŸ«', name: 'è—è“' },
        { icon: 'ğŸ…', name: 'ç•ªèŒ„' },   { icon: 'ğŸŒ½', name: 'ç‰ç±³' }
    ];

    // éæ°´æœåˆ—è¡¨ (é™·é˜±ï¼šå‹•ç‰©ã€äº¤é€šã€ç‰©å“)
    const trapPool = [
        { icon: 'ğŸ¶', name: 'å°ç‹—' }, { icon: 'ğŸ±', name: 'è²“å’ª' },
        { icon: 'ğŸ¦', name: 'ç…å­' }, { icon: 'ğŸ·', name: 'å°è±¬' },
        { icon: 'ğŸ¸', name: 'é’è›™' }, { icon: 'ğŸµ', name: 'çŒ´å­' },
        { icon: 'ğŸ¼', name: 'ç†Šè²“' }, { icon: 'ğŸ”', name: 'å…¬é›' },
        { icon: 'ğŸŒµ', name: 'ä»™äººæŒ' }, { icon: 'ğŸŒ»', name: 'å‘æ—¥è‘µ' },
        { icon: 'ğŸŒ¹', name: 'ç«ç‘°èŠ±' }, { icon: 'ğŸŒ²', name: 'å¤§æ¨¹' },
        { icon: 'ğŸš—', name: 'æ±½è»Š' }, { icon: 'âœˆï¸', name: 'é£›æ©Ÿ' },
        { icon: 'ğŸš²', name: 'è…³è¸è»Š' }, { icon: 'ğŸš‘', name: 'æ•‘è­·è»Š' },
        { icon: 'â°', name: 'é¬§é˜' }, { icon: 'ğŸˆ', name: 'æ°£çƒ' },
        { icon: 'ğŸ¦', name: 'å†°æ·‡æ·‹' }, { icon: 'ğŸ”', name: 'æ¼¢å ¡' }
    ];

    /* =========================================
       2. éŠæˆ²è®Šæ•¸èˆ‡å·¥å…·
       ========================================= */
    
    let currentGridItems = [];
    let collectedCount = 0;
    const targetCount = 6;
    let isGameActive = false;
    let audioContext = null;

    // æ´—ç‰Œæ¼”ç®—æ³• (Fisher-Yates)
    function shuffle(array) {
        let newArr = [...array];
        for (let i = newArr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [newArr[i], newArr[j]] = [newArr[j], newArr[i]];
        }
        return newArr;
    }

    /* =========================================
       3. éŸ³æ•ˆèˆ‡èªéŸ³ç³»çµ±
       ========================================= */

    // åˆå§‹åŒ–éŸ³æ•ˆç’°å¢ƒ (ç€è¦½å™¨éœ€è¦ä½¿ç”¨è€…äº’å‹•å¾Œæ‰èƒ½é–‹å•Ÿ AudioContext)
    function initAudio() {
        if (!audioContext) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }
        if (audioContext.state === 'suspended') {
            audioContext.resume();
        }
    }

    // æ’­æ”¾åˆæˆéŸ³æ•ˆ (ç„¡éœ€å¤–éƒ¨æª”æ¡ˆ)
    function playTone(type) {
        if (!audioContext) return;
        
        const osc = audioContext.createOscillator();
        const gain = audioContext.createGain();
        const now = audioContext.currentTime;

        if (type === 'correct') { // æ¸…è„†çš„é«˜éŸ³
            osc.type = 'sine';
            osc.frequency.setValueAtTime(600, now);
            osc.frequency.exponentialRampToValueAtTime(1200, now + 0.15);
            gain.gain.setValueAtTime(0.1, now);
            gain.gain.linearRampToValueAtTime(0, now + 0.3);
            osc.start(now);
            osc.stop(now + 0.3);
        } else if (type === 'wrong') { // ä½æ²‰çš„éŒ¯èª¤éŸ³
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, now);
            osc.frequency.linearRampToValueAtTime(100, now + 0.3);
            gain.gain.setValueAtTime(0.1, now);
            gain.gain.linearRampToValueAtTime(0, now + 0.4);
            osc.start(now);
            osc.stop(now + 0.4);
        } else if (type === 'win') { // å‹åˆ©æ—‹å¾‹
            // ç°¡å–®çš„ä¸‰é€£éŸ³
            const notes = [523.25, 659.25, 783.99]; // C5, E5, G5
            notes.forEach((freq, i) => {
                const o = audioContext.createOscillator();
                const g = audioContext.createGain();
                o.type = 'triangle';
                o.frequency.value = freq;
                g.gain.setValueAtTime(0.1, now + i * 0.1);
                g.gain.exponentialRampToValueAtTime(0.001, now + i * 0.1 + 0.3);
                o.connect(g);
                g.connect(audioContext.destination);
                o.start(now + i * 0.1);
                o.stop(now + i * 0.1 + 0.3);
            });
        } else {
            // é€£æ¥
            osc.connect(gain);
            gain.connect(audioContext.destination);
        }
    }

    // èªéŸ³æœ—è®€ (TTS)
    function speak(text) {
        if ('speechSynthesis' in window) {
            window.speechSynthesis.cancel(); // åœæ­¢ä¸Šä¸€å¥
            const u = new SpeechSynthesisUtterance(text);
            u.lang = 'zh-TW'; // è¨­å®šä¸­æ–‡
            u.rate = 1.0;     // èªé€Ÿæ­£å¸¸
            window.speechSynthesis.speak(u);
        }
    }

    /* =========================================
       4. éŠæˆ²æ ¸å¿ƒé‚è¼¯
       ========================================= */

    function startGame() {
        initAudio(); // ç¢ºä¿éŸ³æ•ˆå¼•æ“å•Ÿå‹•

        // UI åˆå§‹åŒ–
        document.getElementById('overlay').classList.add('hidden');
        document.getElementById('status-text').textContent = "è«‹æ‰¾å‡ºæ‰€æœ‰ 6 å€‹æ°´æœ";
        document.getElementById('status-text').style.color = "#636e72";
        const grid = document.getElementById('grid');
        grid.innerHTML = '';
        
        collectedCount = 0;
        isGameActive = true;

        // --- ç”¢ç”Ÿä¸é‡è¤‡çš„éš¨æ©Ÿé—œå¡ ---
        // 1. éš¨æ©Ÿå– 6 å€‹æ°´æœ
        const safeItems = shuffle(fruitPool).slice(0, targetCount).map(i => ({...i, type: 'fruit'}));
        // 2. éš¨æ©Ÿå– 3 å€‹é™·é˜±
        const trapItems = shuffle(trapPool).slice(0, 3).map(i => ({...i, type: 'trap'}));
        // 3. åˆä½µä¸¦å†æ¬¡æ´—ç‰Œ
        currentGridItems = shuffle([...safeItems, ...trapItems]);

        // --- æ¸²æŸ“ç•«é¢ ---
        currentGridItems.forEach((item, index) => {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.textContent = item.icon; // é¡¯ç¤º Emoji
            cell.onclick = () => handleInput(index, cell, item);
            grid.appendChild(cell);
        });

        // èªéŸ³æç¤º
        setTimeout(() => speak("è«‹é»é¸æ°´æœ"), 500);
    }

    function handleInput(index, cell, item) {
        if (!isGameActive || cell.classList.contains('correct')) return;

        // 1. å…ˆæœ—è®€ç‰©å“åç¨±
        speak(item.name);

        // 2. åˆ¤æ–·é‚è¼¯
        if (item.type === 'fruit') {
            // --- ç­”å° ---
            cell.classList.add('correct'); // è®Šç¶  + é–å®š
            playTone('correct');
            collectedCount++;
            
            // æ›´æ–°ç‹€æ…‹æ–‡å­—
            document.getElementById('status-text').textContent = `å¥½æ£’ï¼é€™æ˜¯${item.name} (${collectedCount}/${targetCount})`;
            document.getElementById('status-text').style.color = "#00b894";

            // æª¢æŸ¥éé—œ
            if (collectedCount === targetCount) {
                endGame(true);
            }
        } else {
            // --- ç­”éŒ¯ ---
            cell.classList.add('wrong'); // è®Šç´… + éœ‡å‹•
            playTone('wrong');
            
            // è¦–è¦ºæç¤ºå¤±æ•—
            document.getElementById('status-text').textContent = `å“å‘€ï¼${item.name}ä¸æ˜¯æ°´æœå–”`;
            document.getElementById('status-text').style.color = "#d63031";
            
            endGame(false);
        }
    }

    function endGame(isWin) {
        isGameActive = false;
        
        // å»¶é²é¡¯ç¤ºçµç®—ç•«é¢ (è®“ç©å®¶è½å®Œæœ€å¾Œä¸€å€‹ç‰©å“çš„ç™¼éŸ³)
        setTimeout(() => {
            const overlay = document.getElementById('overlay');
            const title = document.getElementById('overlay-title');
            const btn = document.getElementById('action-btn');

            overlay.classList.remove('hidden');

            if (isWin) {
                title.textContent = "ğŸ‰ éé—œï¼å¤ªæ£’äº†ï¼";
                btn.textContent = "å†ç©ä¸€æ¬¡";
                playTone('win');
                speak("éé—œï¼Œå¤ªæ£’äº†");
            } else {
                title.textContent = "ğŸ’¥ æŒ‘æˆ°å¤±æ•—...";
                btn.textContent = "å†è©¦ä¸€æ¬¡";
                speak("å“å‘€ï¼Œé¸éŒ¯äº†");
            }
        }, 1200);
    }
</script>

</body>
</html>
